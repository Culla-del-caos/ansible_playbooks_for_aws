---
 - name:  provisioning EC2 instances
   hosts: localhost
   connection: local
   gather_facts: False

   vars:
     ec2_name: SAP-test
     keypair: DEV-SAP
     instance_type: c5a.large
     image: ami-06a2bd7590c2b50cc
     count: 1
     region: eu-south-1
     IAM_role: AmazonSSMRoleForInstancesQuickSetup
     security_group: sg-057b7dbf3ceadfaa8
     subnet_id:  subnet-0f410a2b2aebd094e

   tasks:

    - name: launch specific number of multiple instances
      amazon.aws.ec2_instance:
        name: "{{ ec2_name }}"
        key_name: "{{ keypair }}"
        instance_type: "{{ instance_type }}"
        image_id: "{{ image }}"
        count: "{{ count }}"
        region: "{{ region }}"
        instance_role: "{{ IAM_role }}"
        network:
          assign_public_ip: no
          security_group: "{{ security_group }}"
          vpc_subnet_id: "{{ subnet_id }}"
        state: present
        tags:
          map-migrated: d-server-03s9krfq3yewa5
        user_data: "{{ lookup('file', 'user_data.sh') }}"